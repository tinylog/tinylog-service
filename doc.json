{
  "openapi": "3.0.0",
  "info": {
    "title": "TinyLog-Service API",
    "description": "API Document for TinyLog",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "https://api.example.com/v1",
      "description": "test"
    }
  ],
  "paths": {
    "/log/initialize": {
      "post": {
        "description": "建立会话",
        "tags": ["log"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IToken"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "applicaton/json": {
              "schema": {
                "$ref": "#/components/schemas/IInitialize"
              }
            }
          }
        }
      }
    },
    "/log/page": {
      "post": {
        "description": "页面数据",
        "tags": ["log"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IPageId"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "applicaton/json": {
              "schema": {
                "$ref": "#/components/schemas/IPageInfo"
              }
            }
          }
        }
      }
    },
    "/log/assets": {
      "post": {
        "description": "页面资源数据",
        "tags": ["log"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IDefaultSuccessResponse"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "applicaton/json": {
              "schema": {
                "$ref": "#/components/schemas/IAssetsInfo"
              }
            }
          }
        }
      }
    },
    "/log/exit": {
      "post": {
        "description": "网页退出",
        "tags": ["log"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IDefaultSuccessResponse"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "applicaton/json": {
              "schema": {
                "$ref": "#/components/schemas/IExit"
              }
            }
          }
        }
      }
    },
    "/user/login": {
      "post": {
        "description": "登录，后续认证依赖 Cookie 里处理，前端不用做任何处理",
        "tags": ["user"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IDefaultSuccessResponse"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "applicaton/json": {
              "schema": {
                "$ref": "#/components/schemas/IUserLogin"
              }
            }
          }
        }
      }
    },
    "/user/register": {
      "post": {
        "description": "注册，注册后即自动登录，后续认证依赖 Cookie 里处理，前端不用做任何处理",
        "tags": ["user"],
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IDefaultSuccessResponse"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "applicaton/json": {
              "schema": {
                "$ref": "#/components/schemas/IUserRegister"
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "log"
    },
    {
      "name": "user"
    }
  ],
  "components": {
    "schemas": {
      "IToken": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string"
          }
        },
        "required": ["token"]
      },
      "IInitialize": {
        "type": "object",
        "properties": {
          "referrer": {
            "type": "string"
          },
          "lang": {
            "type": "string"
          },
          "ua": {
            "type": "string"
          },
          "os": {
            "type": "string"
          }
        },
        "required": ["lang", "os", "referrer", "ua"]
      },
      "IPageId": {
        "type": "object",
        "properties": {
          "pageId": {
            "type": "number"
          }
        },
        "required": ["pageId"]
      },
      "IPageInfo": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string"
          },
          "startTime": {
            "description": "Enables basic storage and retrieval of dates and times.",
            "type": "string",
            "format": "date-time"
          },
          "prePageId": {
            "type": "number"
          },
          "referrer": {
            "type": "string"
          },
          "loadPage": {
            "type": "number"
          },
          "domReady": {
            "type": "number"
          },
          "redirect": {
            "type": "number"
          },
          "lookupDomain": {
            "type": "number"
          },
          "ttfb": {
            "type": "number"
          },
          "request": {
            "type": "number"
          },
          "tcp": {
            "type": "number"
          },
          "loadEvent": {
            "type": "number"
          }
        },
        "required": [
          "domReady",
          "loadEvent",
          "loadPage",
          "lookupDomain",
          "redirect",
          "referrer",
          "request",
          "startTime",
          "tcp",
          "ttfb",
          "url"
        ]
      },
      "IDefaultSuccessResponse": {
        "type": "object"
      },
      "IAsset": {
        "type": "object",
        "properties": {
          "entryType": {
            "type": "string"
          },
          "initiatorType": {
            "type": "number"
          },
          "name": {
            "type": "string"
          },
          "redirect": {
            "type": "number"
          },
          "lookupDomain": {
            "type": "number"
          },
          "request": {
            "type": "number"
          },
          "duration": {
            "type": "number"
          }
        },
        "required": ["duration", "entryType", "initiatorType", "lookupDomain", "name", "redirect", "request"]
      },
      "IAssetsInfo": {
        "type": "object",
        "properties": {
          "pageId": {
            "type": "number"
          },
          "assets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/IAsset"
            }
          }
        },
        "required": ["assets", "pageId"]
      },
      "IExit": {
        "type": "object",
        "properties": {
          "pageId": {
            "type": "number"
          },
          "exitTime": {
            "type": "string"
          }
        },
        "required": ["exitTime", "pageId"]
      },
      "IUserLogin": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        },
        "required": ["email", "password"]
      },
      "IUserRegister": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        },
        "required": ["email", "password"]
      }
    }
  }
}
