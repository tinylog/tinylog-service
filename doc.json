{
    "openapi": "3.0.0",
    "info": {
        "title": "TinyLog-Service API",
        "description": "API Document for TinyLog",
        "version": "0.2.0"
    },
    "servers": [
        {
            "url": "https://tinylog.ruiming.me/",
            "description": "Production Server"
        }
    ],
    "paths": {
        "/log/initialize": {
            "post": {
                "description": "建立会话",
                "tags": [
                    "log"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IToken"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IInitialize"
                            }
                        }
                    }
                }
            }
        },
        "/log/page": {
            "post": {
                "description": "页面数据",
                "tags": [
                    "log"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IPageId"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IPageInfo"
                            }
                        }
                    }
                }
            }
        },
        "/log/assets": {
            "post": {
                "description": "页面资源数据",
                "tags": [
                    "log"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IDefaultSuccessResponse"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IAssetsInfo"
                            }
                        }
                    }
                }
            }
        },
        "/log/alive/{pageId}": {
            "get": {
                "description": "会话保持",
                "tags": [
                    "log"
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "pageId",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IDefaultSuccessResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/host/": {
            "get": {
                "tags": [
                    "host"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Host"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "delete": {
                "tags": [
                    "host"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IDefaultSuccessResponse"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IDeleteHost"
                            }
                        }
                    }
                }
            }
        },
        "/host/{id}([0-9]+)": {
            "get": {
                "tags": [
                    "host"
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Host"
                                }
                            }
                        }
                    }
                }
            },
            "patch": {
                "tags": [
                    "host"
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IDefaultSuccessResponse"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IUpdateHost"
                            }
                        }
                    }
                }
            }
        },
        "/host/create": {
            "post": {
                "tags": [
                    "host"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/Host"
                                    }
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ICreateNewHost"
                            }
                        }
                    }
                }
            }
        },
        "/host/{id}([0-9]+)/overview": {
            "get": {
                "tags": [
                    "host"
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "from",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "to",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "step",
                        "schema": {
                            "type": "number",
                            "default": 1
                        }
                    },
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/IHostOverviewItem"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/host/{id}([0-9]+)/distribution/{item}(referrer|lang|country|region|city|osName|browserName|engineName|hostname|org)": {
            "get": {
                "tags": [
                    "host"
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "from",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "to",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "step",
                        "schema": {
                            "type": "number",
                            "default": 1
                        }
                    },
                    {
                        "in": "path",
                        "name": "item",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/IDistributionItem"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/host/{id}([0-9]+)/assets/slow": {
            "get": {
                "tags": [
                    "host"
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "from",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "to",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "step",
                        "schema": {
                            "type": "number",
                            "default": 1
                        }
                    },
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/ISlowestAssetItem"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/host/{id}([0-9]+)/pages/slow": {
            "get": {
                "tags": [
                    "host"
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "from",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "to",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "step",
                        "schema": {
                            "type": "number",
                            "default": 1
                        }
                    },
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/ISlowestPageItem"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/realtime/{id}": {
            "get": {
                "tags": [
                    "realtime"
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "number"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/IActiveSession"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/user/login": {
            "post": {
                "description": "用户登录，服务端返回的 xsrf-token 需要前端设置到名为 xsrf-token 的头部中",
                "tags": [
                    "user"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ILoginOrRegisterRes"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IUserLogin"
                            }
                        }
                    }
                }
            }
        },
        "/user/register": {
            "post": {
                "description": "用户注册，同注册",
                "tags": [
                    "user"
                ],
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ILoginOrRegisterRes"
                                }
                            }
                        }
                    }
                },
                "requestBody": {
                    "required": true,
                    "content": {
                        "applicaton/json": {
                            "schema": {
                                "$ref": "#/components/schemas/IUserRegister"
                            }
                        }
                    }
                }
            }
        }
    },
    "tags": [
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        },
        {
            "name": "log"
        },
        {
            "name": "host"
        },
        {
            "name": "realtime"
        },
        {
            "name": "user"
        }
    ],
    "components": {
        "schemas": {
            "IToken": {
                "type": "object",
                "properties": {
                    "token": {
                        "type": "string"
                    }
                },
                "required": [
                    "token"
                ]
            },
            "IInitialize": {
                "type": "object",
                "properties": {
                    "referrer": {
                        "type": "string"
                    },
                    "lang": {
                        "type": "string"
                    },
                    "ua": {
                        "type": "string"
                    },
                    "host": {
                        "type": "string"
                    },
                    "fingerprint": {
                        "type": "string"
                    },
                    "createdAt": {
                        "type": "string"
                    }
                },
                "required": [
                    "createdAt",
                    "fingerprint",
                    "host",
                    "lang",
                    "referrer",
                    "ua"
                ]
            },
            "IPageId": {
                "type": "object",
                "properties": {
                    "pageId": {
                        "type": "number"
                    }
                },
                "required": [
                    "pageId"
                ]
            },
            "IPageInfo": {
                "type": "object",
                "properties": {
                    "url": {
                        "type": "string"
                    },
                    "createdAt": {
                        "description": "Enables basic storage and retrieval of dates and times.",
                        "type": "string",
                        "format": "date-time"
                    },
                    "prePageId": {
                        "type": "number"
                    },
                    "referrer": {
                        "type": "string"
                    },
                    "loadPage": {
                        "type": "number"
                    },
                    "domReady": {
                        "type": "number"
                    },
                    "redirect": {
                        "type": "number"
                    },
                    "lookupDomain": {
                        "type": "number"
                    },
                    "ttfb": {
                        "type": "number"
                    },
                    "request": {
                        "type": "number"
                    },
                    "tcp": {
                        "type": "number"
                    },
                    "loadEvent": {
                        "type": "number"
                    }
                },
                "required": [
                    "createdAt",
                    "domReady",
                    "loadEvent",
                    "loadPage",
                    "lookupDomain",
                    "redirect",
                    "referrer",
                    "request",
                    "tcp",
                    "ttfb",
                    "url"
                ]
            },
            "IDefaultSuccessResponse": {
                "type": "object"
            },
            "IAsset": {
                "type": "object",
                "properties": {
                    "entryType": {
                        "type": "string"
                    },
                    "initiatorType": {
                        "type": "number"
                    },
                    "name": {
                        "type": "string"
                    },
                    "redirect": {
                        "type": "number"
                    },
                    "lookupDomain": {
                        "type": "number"
                    },
                    "request": {
                        "type": "number"
                    },
                    "duration": {
                        "type": "number"
                    }
                },
                "required": [
                    "duration",
                    "entryType",
                    "initiatorType",
                    "lookupDomain",
                    "name",
                    "redirect",
                    "request"
                ]
            },
            "IAssetsInfo": {
                "type": "object",
                "properties": {
                    "pageId": {
                        "type": "number"
                    },
                    "assets": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/IAsset"
                        }
                    }
                },
                "required": [
                    "assets",
                    "pageId"
                ]
            },
            "User": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "number"
                    },
                    "email": {
                        "description": "用户邮箱",
                        "type": "string"
                    },
                    "password": {
                        "description": "用户密码",
                        "type": "string"
                    }
                },
                "required": [
                    "email",
                    "id",
                    "password"
                ]
            },
            "Host": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "number"
                    },
                    "timezone": {
                        "description": "时区，PV UV 计算需要",
                        "type": "string"
                    },
                    "domain": {
                        "description": "网站",
                        "type": "string"
                    },
                    "createdAt": {
                        "description": "Enables basic storage and retrieval of dates and times.",
                        "type": "string",
                        "format": "date-time"
                    },
                    "updatedAt": {
                        "description": "Enables basic storage and retrieval of dates and times.",
                        "type": "string",
                        "format": "date-time"
                    },
                    "deletedAt": {
                        "description": "Enables basic storage and retrieval of dates and times.",
                        "type": "string",
                        "format": "date-time"
                    },
                    "userId": {
                        "description": "所属用户 ID",
                        "type": "number"
                    },
                    "user": {
                        "$ref": "#/components/schemas/User",
                        "description": "所属用户"
                    }
                },
                "required": [
                    "createdAt",
                    "deletedAt",
                    "domain",
                    "id",
                    "timezone",
                    "updatedAt",
                    "user",
                    "userId"
                ]
            },
            "ICreateNewHost": {
                "type": "object",
                "properties": {
                    "domain": {
                        "type": "string"
                    },
                    "timezone": {
                        "type": "string"
                    }
                },
                "required": [
                    "domain",
                    "timezone"
                ]
            },
            "IUpdateHost": {
                "type": "object",
                "properties": {
                    "timezone": {
                        "type": "string"
                    }
                }
            },
            "IDeleteHost": {
                "type": "object",
                "properties": {
                    "list": {
                        "type": "array",
                        "items": {
                            "type": "number"
                        }
                    }
                },
                "required": [
                    "list"
                ]
            },
            "IHostOverviewItem": {
                "type": "object",
                "properties": {
                    "pv": {
                        "description": "页面访问数（网页浏览量）",
                        "type": "number"
                    },
                    "uv": {
                        "description": "独立访问数（用户数）",
                        "type": "number"
                    },
                    "vv": {
                        "description": "会话数",
                        "type": "number"
                    },
                    "avgVisitTime": {
                        "description": "平均访问时间",
                        "type": "number"
                    },
                    "avgPageCount": {
                        "description": "平均会话访问页面",
                        "type": "number"
                    },
                    "date": {
                        "description": "Enables basic storage and retrieval of dates and times.",
                        "type": "string",
                        "format": "date-time"
                    }
                },
                "required": [
                    "avgPageCount",
                    "avgVisitTime",
                    "date",
                    "pv",
                    "uv",
                    "vv"
                ]
            },
            "IDistributionItem": {
                "type": "object",
                "properties": {
                    "referrer": {
                        "type": "string"
                    },
                    "country": {
                        "type": "string"
                    },
                    "lang": {
                        "type": "string"
                    },
                    "region": {
                        "type": "string"
                    },
                    "city": {
                        "type": "string"
                    },
                    "osName": {
                        "type": "string"
                    },
                    "browserName": {
                        "type": "string"
                    },
                    "engineName": {
                        "type": "string"
                    },
                    "hostname": {
                        "type": "string"
                    },
                    "org": {
                        "type": "string"
                    },
                    "count": {
                        "type": "number"
                    }
                },
                "required": [
                    "count"
                ]
            },
            "ISlowestAssetItem": {
                "type": "object",
                "properties": {
                    "avgDuration": {
                        "type": "number"
                    },
                    "avgRedirect": {
                        "type": "number"
                    },
                    "avgRequest": {
                        "type": "number"
                    },
                    "avgLookupDomain": {
                        "type": "number"
                    },
                    "name": {
                        "type": "string"
                    },
                    "entryType": {
                        "type": "string"
                    }
                },
                "required": [
                    "avgDuration",
                    "avgLookupDomain",
                    "avgRedirect",
                    "avgRequest",
                    "entryType",
                    "name"
                ]
            },
            "ISlowestPageItem": {
                "type": "object",
                "properties": {
                    "avgLoadPage": {
                        "type": "number"
                    },
                    "avgDomReady": {
                        "type": "number"
                    },
                    "avgRedirect": {
                        "type": "number"
                    },
                    "avgLookupDomain": {
                        "type": "number"
                    },
                    "avgTtfb": {
                        "type": "number"
                    },
                    "avgRequest": {
                        "type": "number"
                    },
                    "avgTcp": {
                        "type": "number"
                    },
                    "avgLoadEvent": {
                        "type": "number"
                    },
                    "url": {
                        "type": "string"
                    }
                },
                "required": [
                    "avgDomReady",
                    "avgLoadEvent",
                    "avgLoadPage",
                    "avgLookupDomain",
                    "avgRedirect",
                    "avgRequest",
                    "avgTcp",
                    "avgTtfb",
                    "url"
                ]
            },
            "IPair": {
                "type": "object",
                "properties": {
                    "referrer": {
                        "type": "string"
                    },
                    "browserName": {
                        "type": "string"
                    },
                    "deviceType": {
                        "type": "string"
                    },
                    "city": {
                        "type": "string"
                    },
                    "count": {
                        "type": "number"
                    }
                },
                "required": [
                    "count"
                ]
            },
            "IActiveSession": {
                "type": "object",
                "properties": {
                    "count": {
                        "type": "number"
                    },
                    "referrer": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/IPair"
                        }
                    },
                    "browserName": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/IPair"
                        }
                    },
                    "deviceType": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/IPair"
                        }
                    },
                    "city": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/IPair"
                        }
                    }
                },
                "required": [
                    "browserName",
                    "city",
                    "count",
                    "deviceType",
                    "referrer"
                ]
            },
            "ILoginOrRegisterRes": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "number"
                    },
                    "email": {
                        "type": "string"
                    },
                    "xsrfToken": {
                        "type": "string"
                    },
                    "token": {
                        "type": "string"
                    }
                },
                "required": [
                    "email",
                    "id",
                    "xsrfToken"
                ]
            },
            "IUserLogin": {
                "type": "object",
                "properties": {
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                },
                "required": [
                    "email",
                    "password"
                ]
            },
            "IUserRegister": {
                "type": "object",
                "properties": {
                    "email": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                },
                "required": [
                    "email",
                    "password"
                ]
            }
        }
    }
}